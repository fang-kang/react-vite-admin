import { Component } from 'react';
import $ from 'jquery';
import { Col, Tooltip } from 'antd';

/*
    * 高阶组件 - 扩展搜索面板功能，增加展开折叠搜索面板和全屏退出全屏功能
    * 1、包裹在页面组件外部  SearchPanelHOC(connect(mapStateToProps, mapDispatchToProps)(TransportationKanban))
    * 2、页面组件constructor时需要定定义以下代码，把this传给外层函数
        const { getInstance } = props;
        if (typeof getInstance === 'function') {
            getInstance(this); // 在这里把this暴露给外层函数
        }
    * 3、页面<Col span={24} className="layoutsLineBlock"></Col> 替换成{this.props.ActionPanel}
*/
interface IState {
  isFold: boolean;
  isFullScreen: boolean;
}

const SearchPanelHOC = (WrappedComponent: any) => {
  // eslint-disable-next-line @typescript-eslint/ban-types
  return class extends Component<any, IState> {
    childRef: any;
    constructor(props: any) {
      super(props);
      this.state = {
        isFold: false,
        isFullScreen: false,
      };
    }
    componentDidMount() {
      this.onEvent('fullscreen', 'fullscreenchange');
      this.onEvent('mozFullScreen', 'mozfullscreenchange');
      this.onEvent('webkitIsFullScreen', 'webkitfullscreenchange');
    }

    onEvent = (key: any, changeKey: string) => {
      document.addEventListener(changeKey, () => {
        this.setState({
          isFullScreen: document[key],
        });
        if (!document[key]) {
          $('#container .ant-layout-sider').css('display', 'block');
          $('#container .ant-layout .ant-layout-header').css('display', 'block');
          $('#container .ant-layout .ant-tabs-bar').eq(0).css('display', 'block');
          $('#container .ant-layout .ant-tabs-content').eq(0).css('paddingTop', '26px');
        } else {
          $('#container .ant-layout-sider').css('display', 'none');
          $('#container .ant-layout .ant-layout-header').css('display', 'none');
          $('#container .ant-layout .ant-tabs-bar').eq(0).css('display', 'none');
          $('#container .ant-layout .ant-tabs-content').eq(0).css('paddingTop', '0px');
        }
        this.childRef && this.childRef.resize && this.childRef.resize();
      });
    };
    fullScreen = () => {
      if (!this.state.isFullScreen) {
        this.requestFullScreen();
      } else {
        this.exitFullscreen();
      }
    };
    // 进入全屏
    requestFullScreen = () => {
      const de = document.documentElement as any;
      if (de.requestFullscreen) {
        de.requestFullscreen();
      } else if (de.mozRequestFullScreen) {
        de.mozRequestFullScreen();
      } else if (de.webkitRequestFullScreen) {
        de.webkitRequestFullScreen();
      }
    };
    // 退出全屏
    exitFullscreen = () => {
      const de = document as any;
      if (de.exitFullscreen) {
        de.exitFullscreen();
      } else if (de.mozCancelFullScreen) {
        de.mozCancelFullScreen();
      } else if (de.webkitCancelFullScreen) {
        de.webkitCancelFullScreen();
      }
    };
    // 折叠
    changeFoldSearchPanel = () => {
      this.setState({ isFold: !this.state.isFold }, () => {
        $('.ant-tabs-tabpane-active .layoutsContainer .layoutsLine').css(
          'display',
          this.state.isFold ? 'none' : 'block'
        );
        $('.ant-tabs-tabpane-active .layoutsContainer .layoutsSearch').css(
          'display',
          this.state.isFold ? 'none' : 'block'
        );
        this.childRef && this.childRef.resize && this.childRef.resize();
      });
    };
    renderActionpanel = () => {
      const { isFold, isFullScreen } = this.state;
      return (
        <Col span={24} className="layoutsLineBlock">
          <Tooltip title={isFold ? '展开查询' : '收起查询'}>
            <a
              className="layouts-lineblock-icon"
              onClick={this.changeFoldSearchPanel}
              data-click={`{ "button": "${this.state.isFold ? '展开查询' : '收起查询'}" }`}
            >
              {isFold ? (
                <svg width="8px" height="8px" viewBox="0 0 8 8">
                  {/* <title>展开查询</title> */}
                  <desc>Created with Sketch.</desc>
                  <g id="报表" stroke="none" strokeWidth="1" fill="none" fillRule="evenodd">
                    <g id="报表-展开" transform="translate(-1393.000000, -294.000000)" fill="#666666">
                      <g id="收起备份" transform="translate(1393.000000, 294.000000)">
                        <path
                          d="M4.00193001,4.91827501 C3.87610154,4.91827501 3.75027306,4.87027306 3.65426917,4.77426917 L0.177660834,1.29766083 C-0.0143469427,1.10565306 -0.0143469427,0.794346943 0.177660834,0.602339166 C0.369668611,0.410331389 0.680974725,0.410331389 0.872982502,0.602339166 L4.00193001,3.73128667 L7.13087752,0.602339166 C7.32288529,0.410331389 7.63419141,0.410331389 7.82619918,0.602339166 C8.01820696,0.794346943 8.01820696,1.10565306 7.82619918,1.29766083 L4.34959084,4.77426917 C4.25358695,4.87027306 4.12775848,4.91827501 4.00193001,4.91827501 Z M0.5,6.94289322 L7.5,6.94289322 C7.77614237,6.94289322 8,7.16675084 8,7.44289322 C8,7.71903559 7.77614237,7.94289322 7.5,7.94289322 L0.5,7.94289322 C0.223857625,7.94289322 3.38176876e-17,7.71903559 0,7.44289322 C-3.38176876e-17,7.16675084 0.223857625,6.94289322 0.5,6.94289322 Z"
                          id="形状结合"
                        ></path>
                      </g>
                    </g>
                  </g>
                </svg>
              ) : (
                <svg width="8px" height="8px" viewBox="0 0 8 8">
                  {/* <title>折叠查询</title> */}
                  <desc>Created with Sketch.</desc>
                  <g id="报表" stroke="none" strokeWidth="1" fill="none" fillRule="evenodd">
                    <g id="报表-展开" transform="translate(-1393.000000, -294.000000)" fill="#666666">
                      <g id="编组" transform="translate(1393.000000, 294.000000)">
                        <path
                          d="M4.00193001,0.0672588984 C4.12775848,0.0672588984 4.25358695,0.115260843 4.34959084,0.211264731 L7.82619918,3.68787307 C8.01820696,3.87988085 8.01820696,4.19118696 7.82619918,4.38319474 C7.63419141,4.57520252 7.32288529,4.57520252 7.13087752,4.38319474 L4.00193001,1.25424723 L0.872982502,4.38319474 C0.680974725,4.57520252 0.369668611,4.57520252 0.177660834,4.38319474 C-0.0143469427,4.19118696 -0.0143469427,3.87988085 0.177660834,3.68787307 L3.65426917,0.211264731 C3.75027306,0.115260843 3.87610154,0.0672588984 4.00193001,0.0672588984 Z M0.5,6.94289322 L7.5,6.94289322 C7.77614237,6.94289322 8,7.16675084 8,7.44289322 C8,7.71903559 7.77614237,7.94289322 7.5,7.94289322 L0.5,7.94289322 C0.223857625,7.94289322 3.38176876e-17,7.71903559 0,7.44289322 C-3.38176876e-17,7.16675084 0.223857625,6.94289322 0.5,6.94289322 Z"
                          id="形状结合"
                        ></path>
                      </g>
                    </g>
                  </g>
                </svg>
              )}
            </a>
          </Tooltip>
          <Tooltip title={isFullScreen ? '缩放' : '全屏'}>
            <a
              className="layouts-lineblock-icon"
              onClick={this.fullScreen}
              data-click={`{"button": "${this.props.isFullScreen ? '缩放' : '全屏'}" }`}
            >
              {isFullScreen ? (
                <svg width="8px" height="8px" viewBox="0 0 8 8">
                  {/* <title>缩放</title> */}
                  <desc>Created with Sketch.</desc>
                  <g id="报表" stroke="none" strokeWidth="1" fill="none" fillRule="evenodd">
                    <g id="图标效果" transform="translate(-295.000000, -26.000000)" fill="#666666" fillRule="nonzero">
                      <path
                        d="M302.869655,26.1163172 C302.714485,25.9612276 302.448551,25.9612276 302.271371,26.1163172 L300.764341,27.6010763 L300.764341,26.4044418 C300.764341,26.2270917 300.631369,26.0941999 300.45419,26.0941999 L300.232633,26.0941999 C300.055283,26.0941999 299.922303,26.2049833 299.922303,26.3600729 L299.922303,28.5540446 L299.944501,28.5540446 L299.922303,28.7091163 C299.922303,28.7978004 299.944501,28.8642955 299.988887,28.9307548 C300.033086,28.975061 300.121841,29.0193582 300.210444,29.0193582 L300.365596,29.0193582 L302.559352,29.0415471 C302.736692,29.0415471 302.869655,28.8863769 302.869655,28.7313142 L302.869655,28.5096758 C302.847466,28.3102262 302.692458,28.1994428 302.515126,28.1994428 L301.362794,28.1994428 L302.847457,26.7146747 C303.046986,26.5595941 303.046986,26.2935868 302.869646,26.1163172 L302.869655,26.1163172 Z M295.116389,33.8614558 C295.271389,34.0166081 295.537323,34.0166081 295.714673,33.8614558 L297.221686,32.3767594 L297.221686,33.5512945 C297.221686,33.7284745 297.354505,33.8614558 297.531845,33.8614558 L297.753555,33.8614558 C297.930743,33.8614558 298.063723,33.7506724 298.063723,33.5955201 L298.063723,31.4237911 L298.041535,31.4237911 L298.063723,31.2686388 C298.063723,31.1800443 298.041535,31.1136387 297.997318,31.047072 C297.952941,31.0026941 297.864185,30.9584775 297.7756,30.9584775 L297.62044,30.9584775 L295.426693,30.9362886 C295.249191,30.9362886 295.11638,31.0914498 295.11638,31.2464499 L295.11638,31.46816 C295.138569,31.6675379 295.293569,31.7783213 295.470909,31.7783213 L296.623223,31.7783213 L295.116363,33.2631699 C294.961211,33.4183222 294.961211,33.6842668 295.116372,33.8614558 L295.116389,33.8614558 Z M299.914084,31.4459755 L299.914084,33.6178568 C299.914084,33.7950368 300.069254,33.8836224 300.224253,33.8836224 L300.445953,33.8836224 C300.623142,33.8836224 300.756122,33.7286223 300.756122,33.5734611 L300.756122,32.3989349 L302.263135,33.8836224 C302.418126,34.0387925 302.684078,34.0387925 302.861427,33.8836224 C303.01657,33.7286223 303.01657,33.4626866 302.861427,33.2853454 L301.354558,31.8006579 L302.50689,31.8006579 C302.684069,31.8006579 302.839239,31.6897312 302.861427,31.4903534 L302.861427,31.2687776 C302.861427,31.0914364 302.706249,30.958473 302.55125,30.958473 L300.401576,30.9806619 L300.246406,30.9806619 C300.157821,30.9806619 300.091407,31.0028508 300.024849,31.0692564 C299.980481,31.1136343 299.958453,31.2022287 299.958453,31.2908232 L299.914084,31.4459755 C299.936273,31.4459755 299.914084,31.4459755 299.914084,31.4459755 L299.914084,31.4459755 Z M296.645451,28.1994339 L295.493119,28.1994339 C295.31577,28.1994339 295.16077,28.3102262 295.138591,28.5096668 L295.138591,28.7313142 C295.138591,28.9085838 295.293581,29.0415471 295.448894,29.0415471 L297.642641,29.0193582 L297.797953,29.0193582 C297.886386,29.0193582 297.952953,28.9971693 298.01951,28.9307548 C298.063736,28.8863769 298.085916,28.7977914 298.085916,28.7091163 L298.063736,28.5540446 L298.085916,28.5540446 L298.085916,26.360064 C298.085916,26.1827944 297.952944,26.094191 297.775756,26.094191 L297.554199,26.094191 C297.376697,26.094191 297.243887,26.2270827 297.243887,26.4044239 L297.243887,27.6010853 L295.737026,26.1163172 C295.581713,25.9612276 295.31577,25.9612276 295.138591,26.1163172 C294.983412,26.2714695 294.983412,26.5374052 295.138591,26.7146747 L296.645451,28.1994339 Z"
                        id="缩放"
                      ></path>
                    </g>
                  </g>
                </svg>
              ) : (
                <svg width="8px" height="8px" viewBox="0 0 8 8">
                  {/* <title>全屏</title> */}
                  <desc>Created with Sketch.</desc>
                  <g id="报表" stroke="none" strokeWidth="1" fill="none" fillRule="evenodd">
                    <g id="图标效果" transform="translate(-228.000000, -26.000000)" fill="#666666" fillRule="nonzero">
                      <path
                        d="M233.052648,28.9252299 C233.207818,29.0803195 233.473752,29.0803195 233.650931,28.9252299 L235.157962,27.4404708 L235.157962,28.6371053 C235.157962,28.8144555 235.290934,28.9473472 235.468113,28.9473472 L235.68967,28.9473472 C235.867019,28.9473472 236,28.8365638 236,28.6814742 L236,26.4875025 L235.977802,26.4875025 L236,26.3324308 C236,26.2437468 235.977802,26.1772517 235.933416,26.1107924 C235.889217,26.0664862 235.800462,26.0221889 235.711859,26.0221889 L235.556707,26.0221889 L233.362951,26 C233.185611,26 233.052648,26.1551702 233.052648,26.3102329 L233.052648,26.5318714 C233.074837,26.7313209 233.229845,26.8421043 233.407177,26.8421043 L234.559509,26.8421043 L233.074846,28.3268724 C232.875317,28.481953 232.875317,28.7479604 233.052657,28.9252299 L233.052648,28.9252299 Z M230.947334,31.0526528 C230.792335,30.8975005 230.5264,30.8975005 230.349051,31.0526528 L228.842038,32.5373492 L228.842038,31.3628141 C228.842038,31.1856341 228.709218,31.0526528 228.531878,31.0526528 L228.310169,31.0526528 C228.132981,31.0526528 228,31.1634362 228,31.3185885 L228,33.4903175 L228.022189,33.4903175 L228,33.6454698 C228,33.7340643 228.022189,33.8004699 228.066405,33.8670366 C228.110783,33.9114145 228.199538,33.9556311 228.288123,33.9556311 L228.443284,33.9556311 L230.637031,33.97782 C230.814532,33.97782 230.947343,33.8226588 230.947343,33.6676587 L230.947343,33.4459487 C230.925154,33.2465708 230.770155,33.1357874 230.592814,33.1357874 L229.4405,33.1357874 L230.947361,31.6509387 C231.102512,31.4957864 231.102512,31.2298418 230.947352,31.0526528 L230.947334,31.0526528 Z M235.977784,33.5124975 L235.977784,31.3406162 C235.977784,31.1634362 235.822615,31.0748507 235.667615,31.0748507 L235.445915,31.0748507 C235.268727,31.0748507 235.135746,31.2298507 235.135746,31.385012 L235.135746,32.5595381 L233.628734,31.0748507 C233.473743,30.9196805 233.207791,30.9196805 233.030441,31.0748507 C232.875299,31.2298507 232.875299,31.4957864 233.030441,31.6731276 L234.537311,33.1578151 L233.384979,33.1578151 C233.2078,33.1578151 233.05263,33.2687418 233.030441,33.4681197 L233.030441,33.6896954 C233.030441,33.8670366 233.18562,34 233.340619,34 L235.490293,33.9778111 L235.645462,33.9778111 C235.734048,33.9778111 235.800462,33.9556222 235.867019,33.8892166 C235.911388,33.8448388 235.933416,33.7562443 235.933416,33.6676498 L235.977784,33.5124975 C235.955596,33.5124975 235.977784,33.5124975 235.977784,33.5124975 L235.977784,33.5124975 Z M229.462671,26.8421133 L230.615003,26.8421133 C230.792353,26.8421133 230.947352,26.7313209 230.969532,26.5318803 L230.969532,26.3102329 C230.969532,26.1329634 230.814541,26 230.659229,26 L228.465482,26.0221889 L228.310169,26.0221889 C228.221736,26.0221889 228.155169,26.0443778 228.088612,26.1107924 C228.044387,26.1551702 228.022207,26.2437557 228.022207,26.3324308 L228.044387,26.4875025 L228.022207,26.4875025 L228.022207,28.6814832 C228.022207,28.8587527 228.155178,28.9473562 228.332367,28.9473562 L228.553924,28.9473562 C228.731425,28.9473562 228.864236,28.8144644 228.864236,28.6371232 L228.864236,27.4404619 L230.371096,28.9252299 C230.526409,29.0803195 230.792353,29.0803195 230.969532,28.9252299 C231.12471,28.7700776 231.12471,28.504142 230.969532,28.3268724 L229.462671,26.8421133 Z"
                        id="形状备份-3"
                      ></path>
                    </g>
                  </g>
                </svg>
              )}
            </a>
          </Tooltip>
        </Col>
      );
    };
    render() {
      return (
        <WrappedComponent
          {...this.state}
          getInstance={(childRef: any) => {
            this.childRef = childRef;
          }}
          ActionPanel={this.renderActionpanel()}
        />
      );
    }
  };
};
export { SearchPanelHOC };
